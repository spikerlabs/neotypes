<!DOCTYPE html><html><head><title>neotypes: Streaming</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="neotypes" /><meta name="description" content="Scala lightweight, type-safe, asynchronous driver for neo4j" /><meta name="og:image" content="/neotypes/img/poster.png" /><meta name="image" property="og:image" content="/neotypes/img/poster.png" /><meta name="og:title" content="neotypes: Streaming" /><meta name="title" property="og:title" content="neotypes: Streaming" /><meta name="og:site_name" content="neotypes" /><meta name="og:url" content="https://neotypes.github.io/neotypes/" /><meta name="og:type" content="website" /><meta name="og:description" content="Scala lightweight, type-safe, asynchronous driver for neo4j" /><link rel="icon" type="image/png" href="/neotypes/img/favicon.png" /><meta name="twitter:title" content="neotypes: Streaming" /><meta name="twitter:image" content="/neotypes/img/poster.png" /><meta name="twitter:description" content="Scala lightweight, type-safe, asynchronous driver for neo4j" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/neotypes/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/neotypes/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/neotypes/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/neotypes/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/neotypes/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/neotypes/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/neotypes/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/neotypes/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/neotypes/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/neotypes/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/neotypes/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/neotypes/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/neotypes/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/neotypes/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/neotypes/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/neotypes/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/neotypes/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/neotypes/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/neotypes/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/neotypes/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/neotypes/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/neotypes/css/pattern-style.css" /><link rel="stylesheet" href="/neotypes/css/style.css" /></head><body><header id="site-header"><div class="navbar-wrapper navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/neotypes/" class="brand"><div class="icon-wrapper"><span>neotypes</span></div></a></div><nav class="text-right"><ul class=""><li><a href="https://github.com/neotypes/neotypes" target="_blank" rel="noopener noreferrer"><i class="fa fa-github"></i><span class="hidden-xs">GitHub</span></a></li><li><a href="/neotypes/api/neotypes/index.html"><i class="fa fa-file-text"></i><span class="hidden-xs">API Documentation</span></a></li></ul></nav></div></div><div class="jumbotron" style="background-image:url('/neotypes/img/jumbotron_pattern.png')"></div><div id="horizontal-menu"><ul class="horizontal-nav"><li><a class="" href="/neotypes/">Home</a></li><li><a class="" href="/neotypes/overview.html">Overview</a></li><li><a class="" href="/neotypes/parameterized_queries.html">Parameterized Queries</a></li><li><a class="" href="/neotypes/types.html">Supported types</a></li><li><a class="" href="/neotypes/alternative_effects.html">Alternative effects</a></li><li><a class=" active " href="/neotypes/streams.html">Streaming</a></li><li><a class="" href="/neotypes/driver_session_transaction.html">Transactions</a></li></ul></div></header><main id="site-main" class="page-site-main"><section class="use"><div class="container"><div id="content"><h1 id="streaming">Streaming</h1>

<p><strong>neotypes</strong> allows to stream large results by lazily consuming the result and putting elements into a stream.
Currently, there are four implementations of streaming supported out of the box <em>(one for each effect type)</em> -
<a href="https://doc.akka.io/docs/akka/current/stream/index.html"><strong>Akka Streams</strong></a> <em>(for <code class="highlighter-rouge">scala.concurrent.Future</code>)</em>,
<a href="https://fs2.io/"><strong>FS2</strong></a> <em>(for <code class="highlighter-rouge">cats.effect.Async[F]</code>)</em>,
<a href="https://monix.io/docs/3x/reactive/observable.html"><strong>Monix Observables</strong></a> <em>(for <code class="highlighter-rouge">monix.eval.Task</code>)</em> &amp;
<a href="https://zio.dev/docs/datatypes/datatypes_stream"><strong>ZIO ZStreams</strong></a> <em>(for <code class="highlighter-rouge">zio.Task</code>)</em>.</p>

<h2 id="usage">Usage</h2>

<h3 id="akka-streams-neotypes-akka-stream">Akka Streams <em>(neotypes-akka-stream)</em></h3>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">akka.actor.ActorSystem</span>
<span class="k">import</span> <span class="nn">akka.stream.scaladsl.</span><span class="o">{</span><span class="nc">Sink</span><span class="o">,</span> <span class="nc">Source</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">neotypes.</span><span class="o">{</span><span class="nc">GraphDatabase</span><span class="o">,</span> <span class="nc">Session</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">neotypes.akkastreams.AkkaStream</span>
<span class="k">import</span> <span class="nn">neotypes.akkastreams.implicits._</span> <span class="c1">// Brings the implicit Stream[AkkaStream] instance into the scope. // Brings the implicit Stream[AkkaStream] instance into the scope.</span>
<span class="k">import</span> <span class="nn">neotypes.implicits.mappers.results._</span> <span class="c1">// Brings the implicit ResultMapper[String] instance into the scope. // Brings the implicit ResultMapper[String] instance into the scope.</span>
<span class="k">import</span> <span class="nn">neotypes.implicits.syntax.string._</span> <span class="c1">// Provides the query[T] extension method. // Provides the query[T] extension method.</span>
<span class="k">import</span> <span class="nn">org.neo4j.driver.v1.AuthTokens</span>
<span class="k">import</span> <span class="nn">scala.concurrent.</span><span class="o">{</span><span class="nc">Await</span><span class="o">,</span> <span class="nc">Future</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">scala.concurrent.ExecutionContext.Implicits.global</span>
<span class="k">import</span> <span class="nn">scala.concurrent.duration._</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="nv">system</span> <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="s">"QuickStart"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">driver</span> <span class="k">=</span> <span class="nv">GraphDatabase</span><span class="o">.</span><span class="py">driver</span><span class="o">[</span><span class="kt">Future</span><span class="o">](</span><span class="s">"bolt://localhost:7687"</span><span class="o">,</span> <span class="nv">AuthTokens</span><span class="o">.</span><span class="py">basic</span><span class="o">(</span><span class="s">"neo4j"</span><span class="o">,</span> <span class="s">"****"</span><span class="o">))</span>
<span class="k">val</span> <span class="nv">session</span> <span class="k">=</span> <span class="nv">driver</span><span class="o">.</span><span class="py">session</span>

<span class="k">def</span> <span class="nf">query</span><span class="o">(</span><span class="n">session</span><span class="k">:</span> <span class="kt">Session</span><span class="o">[</span><span class="kt">Future</span><span class="o">])</span><span class="k">:</span> <span class="kt">Source</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Future</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]]</span> <span class="k">=</span>
  <span class="s">"MATCH (p:Person) RETURN p.name"</span><span class="o">.</span><span class="py">query</span><span class="o">[</span><span class="kt">String</span><span class="o">].</span><span class="py">stream</span><span class="o">[</span><span class="kt">AkkaStream</span><span class="o">](</span><span class="n">session</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">program</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
  <span class="k">_</span> <span class="k">&lt;-</span> <span class="nf">query</span><span class="o">(</span><span class="n">session</span><span class="o">).</span><span class="py">runWith</span><span class="o">(</span><span class="nv">Sink</span><span class="o">.</span><span class="py">foreach</span><span class="o">(</span><span class="n">println</span><span class="o">))</span>
  <span class="k">_</span> <span class="k">&lt;-</span> <span class="nv">session</span><span class="o">.</span><span class="py">close</span>
  <span class="k">_</span> <span class="k">&lt;-</span> <span class="nv">driver</span><span class="o">.</span><span class="py">close</span>
<span class="o">}</span> <span class="nf">yield</span> <span class="o">()</span>

<span class="nv">Await</span><span class="o">.</span><span class="py">ready</span><span class="o">(</span><span class="n">program</span><span class="o">,</span> <span class="mf">5.</span><span class="n">seconds</span><span class="o">)</span>
</code></pre></div></div>

<h3 id="fs2-neotypes-fs2-stream">FS2 <em>(neotypes-fs2-stream)</em></h3>

<h4 id="with-catseffectio">With cats.effect.IO</h4>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.effect.</span><span class="o">{</span><span class="nc">IO</span><span class="o">,</span> <span class="nc">Resource</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">fs2.Stream</span>
<span class="k">import</span> <span class="nn">neotypes.</span><span class="o">{</span><span class="nc">GraphDatabase</span><span class="o">,</span> <span class="nc">Session</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">neotypes.cats.effect.implicits._</span> <span class="c1">// Brings the implicit Async[IO] instance into the scope. // Brings the implicit Async[IO] instance into the scope.</span>
<span class="k">import</span> <span class="nn">neotypes.fs2.Fs2IoStream</span>
<span class="k">import</span> <span class="nn">neotypes.fs2.implicits._</span> <span class="c1">// Brings the implicit Stream[Fs2IOStream] instance into the scope. // Brings the implicit Stream[Fs2IOStream] instance into the scope.</span>
<span class="k">import</span> <span class="nn">neotypes.implicits.mappers.results._</span> <span class="c1">// Brings the implicit ResultMapper[String] instance into the scope. // Brings the implicit ResultMapper[String] instance into the scope.</span>
<span class="k">import</span> <span class="nn">neotypes.implicits.syntax.string._</span> <span class="c1">// Provides the query[T] extension method. // Provides the query[T] extension method.</span>
<span class="k">import</span> <span class="nn">org.neo4j.driver.v1.AuthTokens</span>

<span class="k">val</span> <span class="nv">session</span><span class="k">:</span> <span class="kt">Resource</span><span class="o">[</span><span class="kt">IO</span>, <span class="kt">Session</span><span class="o">[</span><span class="kt">IO</span><span class="o">]]</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
  <span class="n">driver</span> <span class="k">&lt;-</span> <span class="nv">GraphDatabase</span><span class="o">.</span><span class="py">driver</span><span class="o">[</span><span class="kt">IO</span><span class="o">](</span><span class="s">"bolt://localhost:7687"</span><span class="o">,</span> <span class="nv">AuthTokens</span><span class="o">.</span><span class="py">basic</span><span class="o">(</span><span class="s">"neo4j"</span><span class="o">,</span> <span class="s">"****"</span><span class="o">))</span>
  <span class="n">session</span> <span class="k">&lt;-</span> <span class="nv">driver</span><span class="o">.</span><span class="py">session</span>
<span class="o">}</span> <span class="k">yield</span> <span class="n">session</span>

<span class="k">val</span> <span class="nv">program</span><span class="k">:</span> <span class="kt">Stream</span><span class="o">[</span><span class="kt">IO</span>, <span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>
  <span class="nv">Stream</span><span class="o">.</span><span class="py">resource</span><span class="o">(</span><span class="n">session</span><span class="o">).</span><span class="py">flatMap</span> <span class="o">{</span> <span class="n">s</span> <span class="k">=&gt;</span>
    <span class="s">"MATCH (p:Person) RETURN p.name"</span>
      <span class="o">.</span><span class="py">query</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
      <span class="o">.</span><span class="py">stream</span><span class="o">[</span><span class="kt">Fs2IoStream</span><span class="o">](</span><span class="n">s</span><span class="o">)</span>
      <span class="o">.</span><span class="py">evalMap</span><span class="o">(</span><span class="n">n</span> <span class="k">=&gt;</span> <span class="nc">IO</span><span class="o">(</span><span class="nf">println</span><span class="o">(</span><span class="n">n</span><span class="o">)))</span>
  <span class="o">}</span>

<span class="nv">program</span><span class="o">.</span><span class="py">compile</span><span class="o">.</span><span class="py">drain</span><span class="o">.</span><span class="py">unsafeRunSync</span><span class="o">()</span>
</code></pre></div></div>

<h4 id="with-other-effect-type">With other effect type</h4>

<p>Basically the same code as above, but replacing <strong>IO</strong> with <strong>F</strong>
<em>(as long as there is an instance of <code class="highlighter-rouge">cats.effect.Async[F]</code>)</em>.
And replacing the <code class="highlighter-rouge">neotypes.fs2.Fs2IoStream</code> type alias
with <code class="highlighter-rouge">neotypes.fs2.Fs2FStream[F]#T</code>.</p>

<h3 id="monix-observables-neotypes-monix-stream">Monix Observables <em>(neotypes-monix-stream)</em></h3>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.effect.Resource</span>
<span class="k">import</span> <span class="nn">monix.eval.Task</span>
<span class="k">import</span> <span class="nn">monix.execution.Scheduler.Implicits.global</span>
<span class="k">import</span> <span class="nn">monix.reactive.Observable</span>
<span class="k">import</span> <span class="nn">neotypes.</span><span class="o">{</span><span class="nc">GraphDatabase</span><span class="o">,</span> <span class="nc">Session</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">neotypes.implicits.mappers.results._</span> <span class="c1">// Brings the implicit ResultMapper[String] instance into the scope. // Brings the implicit ResultMapper[String] instance into the scope.</span>
<span class="k">import</span> <span class="nn">neotypes.implicits.syntax.string._</span> <span class="c1">// Provides the query[T] extension method. // Provides the query[T] extension method.</span>
<span class="k">import</span> <span class="nn">neotypes.monix.implicits._</span> <span class="c1">// Brings the implicit Async[Task] instance into the scope. // Brings the implicit Async[Task] instance into the scope.</span>
<span class="k">import</span> <span class="nn">neotypes.monix.stream.MonixStream</span>
<span class="k">import</span> <span class="nn">neotypes.monix.stream.implicits._</span> <span class="c1">// Brings the implicit Stream[MonixStream] instance into the scope. // Brings the implicit Stream[MonixStream] instance into the scope.</span>
<span class="k">import</span> <span class="nn">org.neo4j.driver.v1.AuthTokens</span>
<span class="k">import</span> <span class="nn">scala.concurrent.duration._</span>

<span class="k">val</span> <span class="nv">session</span><span class="k">:</span> <span class="kt">Resource</span><span class="o">[</span><span class="kt">Task</span>, <span class="kt">Session</span><span class="o">[</span><span class="kt">Task</span><span class="o">]]</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
  <span class="n">driver</span> <span class="k">&lt;-</span> <span class="nv">GraphDatabase</span><span class="o">.</span><span class="py">driver</span><span class="o">[</span><span class="kt">Task</span><span class="o">](</span><span class="s">"bolt://localhost:7687"</span><span class="o">,</span> <span class="nv">AuthTokens</span><span class="o">.</span><span class="py">basic</span><span class="o">(</span><span class="s">"neo4j"</span><span class="o">,</span> <span class="s">"****"</span><span class="o">))</span>
  <span class="n">session</span> <span class="k">&lt;-</span> <span class="nv">driver</span><span class="o">.</span><span class="py">session</span>
<span class="o">}</span> <span class="k">yield</span> <span class="n">session</span>

<span class="k">val</span> <span class="nv">program</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>
  <span class="nv">Observable</span><span class="o">.</span><span class="py">fromResource</span><span class="o">(</span><span class="n">session</span><span class="o">).</span><span class="py">flatMap</span> <span class="o">{</span> <span class="n">s</span> <span class="k">=&gt;</span>
    <span class="s">"MATCH (p:Person) RETURN p.name"</span>
      <span class="o">.</span><span class="py">query</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
      <span class="o">.</span><span class="py">stream</span><span class="o">[</span><span class="kt">MonixStream</span><span class="o">](</span><span class="n">s</span><span class="o">)</span>
      <span class="o">.</span><span class="py">mapEval</span><span class="o">(</span><span class="n">n</span> <span class="k">=&gt;</span> <span class="nc">Task</span><span class="o">(</span><span class="nf">println</span><span class="o">(</span><span class="n">n</span><span class="o">)))</span>
<span class="o">}</span>

<span class="nv">program</span><span class="o">.</span><span class="py">completedL</span><span class="o">.</span><span class="py">runSyncUnsafe</span><span class="o">(</span><span class="mf">5.</span><span class="n">seconds</span><span class="o">)</span>
</code></pre></div></div>

<h3 id="zio-zstreams-neotypes-zio-stream">ZIO ZStreams <em>(neotypes-zio-stream)</em></h3>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">zio.</span><span class="o">{</span><span class="nc">Runtime</span><span class="o">,</span> <span class="nc">Managed</span><span class="o">,</span> <span class="nc">Task</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">zio.stream.ZStream</span>
<span class="k">import</span> <span class="nn">neotypes.</span><span class="o">{</span><span class="nc">GraphDatabase</span><span class="o">,</span> <span class="nc">Session</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">neotypes.implicits.mappers.results._</span> <span class="c1">// Brings the implicit ResultMapper[String] instance into the scope. // Brings the implicit ResultMapper[String] instance into the scope.</span>
<span class="k">import</span> <span class="nn">neotypes.implicits.syntax.string._</span> <span class="c1">// Provides the query[T] extension method. // Provides the query[T] extension method.</span>
<span class="k">import</span> <span class="nn">neotypes.zio.implicits._</span> <span class="c1">// Brings the implicit Async[Task] instance into the scope. // Brings the implicit Async[Task] instance into the scope.</span>
<span class="k">import</span> <span class="nn">neotypes.zio.stream.ZioStream</span>
<span class="k">import</span> <span class="nn">neotypes.zio.stream.implicits._</span> <span class="c1">// Brings the implicit Stream[ZioStream] instance into the scope. // Brings the implicit Stream[ZioStream] instance into the scope.</span>
<span class="k">import</span> <span class="nn">org.neo4j.driver.v1.AuthTokens</span>

<span class="k">val</span> <span class="nv">runtime</span> <span class="k">=</span> <span class="nv">Runtime</span><span class="o">.</span><span class="py">default</span>

<span class="k">val</span> <span class="nv">session</span><span class="k">:</span> <span class="kt">Managed</span><span class="o">[</span><span class="kt">Throwable</span>, <span class="kt">Session</span><span class="o">[</span><span class="kt">Task</span><span class="o">]]</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
  <span class="n">driver</span> <span class="k">&lt;-</span> <span class="nv">GraphDatabase</span><span class="o">.</span><span class="py">driver</span><span class="o">[</span><span class="kt">Task</span><span class="o">](</span><span class="s">"bolt://localhost:7687"</span><span class="o">,</span> <span class="nv">AuthTokens</span><span class="o">.</span><span class="py">basic</span><span class="o">(</span><span class="s">"neo4j"</span><span class="o">,</span> <span class="s">"****"</span><span class="o">))</span>
  <span class="n">session</span> <span class="k">&lt;-</span> <span class="nv">driver</span><span class="o">.</span><span class="py">session</span>
<span class="o">}</span> <span class="k">yield</span> <span class="n">session</span>

<span class="k">val</span> <span class="nv">program</span><span class="k">:</span> <span class="kt">ZStream</span><span class="o">[</span><span class="kt">Any</span>, <span class="kt">Throwable</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
  <span class="nv">ZStream</span><span class="o">.</span><span class="py">managed</span><span class="o">(</span><span class="n">session</span><span class="o">).</span><span class="py">flatMap</span> <span class="o">{</span> <span class="n">s</span> <span class="k">=&gt;</span>
    <span class="s">"MATCH (p:Person) RETURN p.name"</span>
      <span class="o">.</span><span class="py">query</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
      <span class="o">.</span><span class="py">stream</span><span class="o">[</span><span class="kt">ZioStream</span><span class="o">](</span><span class="n">s</span><span class="o">)</span>
  <span class="o">}</span>

<span class="nv">runtime</span><span class="o">.</span><span class="py">unsafeRun</span><span class="o">(</span><span class="nv">program</span><span class="o">.</span><span class="py">foreach</span><span class="o">(</span><span class="n">n</span> <span class="k">=&gt;</span> <span class="nc">Task</span><span class="o">(</span><span class="nf">println</span><span class="o">(</span><span class="n">n</span><span class="o">))))</span>
</code></pre></div></div>

<hr />

<p><em>Please note that the above provided type aliases are just for convenience</em>.</p>

<p><em>You can always use:</em></p>

<ul>
  <li><strong><em>Type lambdas</em>:</strong></li>
</ul>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">query</span><span class="o">.</span><span class="py">stream</span><span class="o">[({</span> <span class="k">type</span> <span class="kt">T</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="kt">=</span> <span class="kt">fs2.Stream</span><span class="o">[</span><span class="kt">IO</span>, <span class="kt">A</span><span class="o">]</span> <span class="o">})</span><span class="k">#</span><span class="kt">T</span><span class="o">](</span><span class="n">session</span><span class="o">)</span>
</code></pre></div></div>

<ul>
  <li><strong><em>Type Alias</em>:</strong></li>
</ul>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="kt">Fs2Stream</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="k">=</span> <span class="nv">fs2</span><span class="o">.</span><span class="py">Stream</span><span class="o">[</span><span class="kt">IO</span>, <span class="kt">T</span><span class="o">]</span>
<span class="nv">query</span><span class="o">.</span><span class="py">stream</span><span class="o">[</span><span class="kt">Fs2Stream</span><span class="o">](</span><span class="n">session</span><span class="o">)</span>
</code></pre></div></div>

<ul>
  <li><strong><a href="https://github.com/typelevel/kind-projector"><em>Kind Projector</em></a>:</strong></li>
</ul>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">query</span><span class="o">.</span><span class="py">stream</span><span class="o">[</span><span class="kt">fs2.Stream</span><span class="o">[</span><span class="kt">IO</span>, <span class="kt">?</span><span class="o">]](</span><span class="n">session</span><span class="o">)</span>
</code></pre></div></div>

<hr />

<p>The code snippets above are lazily retrieving data from neo4j, loading each element of the result only when it’s requested and rolls back the transaction once all elements are read.
This approach aims to improve performance and memory footprint with large volumes of returned data.</p>

<h2 id="transaction-management">Transaction management</h2>

<p>You have two options in transaction management:</p>
<ul>
  <li><strong>Manual</strong>: if you use <code class="highlighter-rouge">neotypes.Transaction</code> and call <code class="highlighter-rouge">stream</code>, you need to ensure that the transaction is gracefully closed after reading is finished.</li>
  <li><strong>Auto-closing</strong>: you may wish to automatically rollback the transaction once
all elements are consumed. This behavior is provided by <code class="highlighter-rouge">DeferredQuery.stream(Session[F])</code></li>
</ul>

<h2 id="alternative-stream-implementations">Alternative stream implementations</h2>

<p>If you don’t see your stream supported.
You can add your implementation of <code class="highlighter-rouge">neotypes.Stream.Aux[S[_], F[_]]</code> <strong>typeclass</strong>.
And add it to the implicit scope.</p>

<p>The type parameters in the signature indicate:</p>

<ul>
  <li><code class="highlighter-rouge">F[_]</code> - the effect that will be used to produce each element retrieval.</li>
  <li><code class="highlighter-rouge">S[_]</code> - the type of your stream.</li>
</ul>
</div></div></section></main><footer id="site-footer"><div class="container"><div class="row"><div class="col-xs-6"><p>neotypes is designed and developed by <a href="" target="_blank" rel="noopener noreferrer">neotypes</a></p></div><div class="col-xs-6"><p class="text-right"><a href="https://github.com/neotypes/neotypes" target="_blank" rel="noopener noreferrer"><span class="fa fa-github"></span>View on GitHub</a></p></div></div><div class="row"><div class="col-xs-6"><p>Website built with <a href="https://47degrees.github.io/sbt-microsites/" target="_blank" rel="noopener noreferrer">sbt-microsites</a> - © 2019 <a href="https://www.47deg.com/" target="_blank" rel="noopener noreferrer">47 Degrees</a></p></div></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/neotypes/highlight/highlight.pack.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script>((window.gitter = {}).chat = {}).options = {
room: 'neotypes/neotypes'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/neotypes/js/version-selector.js"></script></body></html>